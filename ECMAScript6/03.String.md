# å­—ç¬¦ä¸²çš„æ‰©å±•

## 1.å­—ç¬¦çš„ Unicode è¡¨ç¤ºæ³•

`\uxxxx`å¯ä»¥è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦, å…¶ä¸­`xxxx`è¡¨ç¤ºå­—ç¬¦çš„ Unicode ç ç‚¹, ä½†æ˜¯åªé™äºç ç‚¹åœ¨`\u0000`~`\uFFFF`ä¹‹é—´çš„å­—ç¬¦, è¶…è¿‡è¿™ä¸ªèŒƒå›´éœ€è¦ç”¨ä¸¤ä¸ªåŒå­—èŠ‚çš„å½¢å¼è¡¨ç¤º.

```js
"\u0061";
// "a"
"\uD842\uDFB7";
// "ğ ®·"
"\u20BB7";
// " 7"
```

ES6 å¯¹è¿™ç‚¹è¿›è¡Œæ”¹è¿›: å°†ç ç‚¹æ”¾å…¥å¤§æ‹¬å·, å°±èƒ½æ­£ç¡®è§£è¯»å­—ç¬¦ä¸²:

```js
"\u{20BB7}";
// "ğ ®·"

"\u{41}\u{42}\u{43}";
// "ABC"

let hello = 123;
hello; // 123

"\u{1F680}" === "\uD83D\uDE80";
// true
```

é‚£ä¹ˆç°åœ¨ Javascript ä¸€å…±æœ‰ 6 ç§æ–¹æ³•å¯ä»¥è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦:

```js
"z" === "z"; // true
"\172" === "z"; // true
"\x7A" === "z"; // true
"\u007A" === "z"; // true
"\u{7A}" === "z"; // true
```

## 2.å­—ç¬¦ä¸²çš„éå†ç»“æ„

ES6 ä½å­—ç¬¦ä¸²å¢åŠ äº†éå†å™¨æ¥å£(`Iterator`), å¯ä»¥æ˜¯å­—ç¬¦ä¸²è¢«`for...of`å¾ªç¯éå†.

è¿™ä¸ªéå†å™¨æœ€å¤§çš„ä¼˜ç‚¹æ˜¯å¯ä»¥è¯†åˆ«å¤§äº`0xFFFF`çš„ç ç‚¹, ä¼ ç»Ÿ`for`å¾ªç¯æ— æ³•è¯†åˆ«.

```js
let text = String.fromCodePoint(0x20bb7);

for (let i = 0; i < text.length; i++) {
  console.log(text[i]);
}
// "ï¿½"
// "ï¿½"

for (let i in text) {
  console.log(text[i]);
}
// "ï¿½"
// "ï¿½"

for (let i of text) {
  console.log(i);
}
// "ğ ®·"
```

## 3. ç›´æ¥è¾“å…¥ U+2028 å’Œ U+2029

Javascript çš„å­—ç¬¦ä¸²å…è®¸ç›´æ¥è¾“å…¥å­—ç¬¦ä¸², æˆ–è€…è½¬ä¹‰å½¢å¼, æ¯”å¦‚"ä¸­"è¿™ä¸ªæ±‰å­: `'ä¸­' === '\u4e2d'`, è¿™ä¸¤è€…æ˜¯å®Œå…¨ç­‰ä»·çš„.

ä½†æ˜¯æœ‰ 5 ä¸ªå­—ç¬¦æ˜¯ä¸èƒ½ç›´æ¥åœ¨å­—ç¬¦ä¸²é‡Œé¢ä½¿ç”¨çš„, åªèƒ½ä½¿ç”¨è½¬ä¹‰å½¢å¼:

- U+005C: åæ–œæ (reverse solidus)
- U+000D: å›è½¦(carriage return)
- U+2028: è¡Œåˆ†éš”ç¬¦(line separator)
- U+2029: æ®µåˆ†éš”ç¬¦(paragraph separator)
- U+000A: æ¢è¡Œç¬¦(line feed)

æ¯”å¦‚å­—ç¬¦ä¸²ä¸èƒ½ç›´æ¥åŒ…å«åæ–œæ , ä¸€å®šè¦ç›´æ¥è½¬ä¹‰å†™æˆ`\\`æˆ–`\u005c`

JSON æ ¼å¼å…è®¸å­—ç¬¦ä¸²ç›´æ¥ä½¿ç”¨`U+2028(è¡Œåˆ†éš”ç¬¦)`å’Œ`U+2029(æ®µåˆ†éš”ç¬¦)`. è¿™æ ·åœ¨ä½¿ç”¨`JSON.parse`è¿›è¡Œè§£ææ—¶å°±å¯èƒ½ä¼šæŠ¥é”™.

```js
const json = '"\u2028"';
JSON.parse(json); // Uncaught SyntaxError: Unexpected token  in JSON at position 0
```

`ES2019`å…è®¸ JavaScript å­—ç¬¦ä¸²ç›´æ¥è¾“å…¥`U+2028(è¡Œåˆ†éš”ç¬¦)`å’Œ`U+2029(æ®µåˆ†éš”ç¬¦)`;

```js
const PS = eval("'\u2029'");
```

æ³¨æ„: æ¨¡æ¿å­—ç¬¦ä¸²å…è®¸ç›´æ¥è¾“å…¥è¿™ä¸¤ä¸ªå­—ç¬¦, æ­£åˆ™è¡¨è¾¾å¼ä¸å…è®¸ç›´æ¥è¾“å…¥è¿™ä¸¤ä¸ªå­—ç¬¦, å› ä¸º JSON æœ¬æ¥å°±ä¸å…è®¸ç›´æ¥åŒ…å«æ­£åˆ™è¡¨è¾¾å¼.

## 4.JSON.stringify()çš„æ”¹é€ 

JSON æ•°æ®å¿…é¡»æ˜¯ UTF-8 ç¼–ç çš„, ä½†æ˜¯ç°åœ¨çš„`JSON.stringify()`æ–¹æ³•å¯èƒ½è¿”å›ä¸ç¬¦åˆ UTF-8 æ ‡å‡†çš„å­—ç¬¦ä¸².

å…·ä½“æ¥è¯´, UTF-8 æ ‡å‡†è§„å®š, `0xD800`åˆ°`0xDFFF`ä¹‹é—´çš„ç ç‚¹ä¸èƒ½å•ç‹¬ä½¿ç”¨, å¿…é¡»é…å¯¹ä½¿ç”¨, ä¸ºäº†è¡¨ç¤ºç ç‚¹å¤§äº`0xFFFF`çš„å˜é€šæ–¹æ³•. æ¯”å¦‚`\uD834\uDF06`æ˜¯ä¸¤ä¸ªç ç‚¹, ä½†æ˜¯å¿…é¡»æ”¾åœ¨ä¸€èµ·ä½¿ç”¨, ä»£è¡¨å­—ç¬¦`ğŒ†`.

`JSON.stringify()`å¯èƒ½ä¼šè¿”å›`0xD800`åˆ°`0xDFFF`ä¹‹é—´çš„å•ä¸ªç ç‚¹.

```js
JSON.stringify("\u{D834}"); // "\u{D834}"
```

ä¸ºäº†ç¡®ä¿è¿”å›çš„æ˜¯åˆæ³•çš„ UTF-8 å­—ç¬¦, ES2019 æ”¹å˜äº†`JSON.stringify()`çš„è¡Œä¸º, å¦‚æœé‡åˆ°`0xD800`åˆ°`0xDFFF`ä¹‹é—´çš„å•ä¸ªç ç‚¹, æˆ–è€…ä¸å­˜åœ¨çš„é…å¯¹å½¢å¼, å°±ä¼šè¿”å›è½¬ä¹‰çš„å­—ç¬¦ä¸².

```js
JSON.stringify("\u0061"); // '"a"'
JSON.stringify("\uD834\uDF06"); // '"ğŒ†"'
JSON.stringify("\u{D834}"); // '"\ud834"'
JSON.stringify("\uDF06\uD834"); // '"\udf06\ud834"'
```

## 5.æ¨¡æ¿å­—ç¬¦ä¸²

æ¨¡æ¿å­—ç¬¦ä¸²æ˜¯å¢å¼ºç‰ˆçš„å­—ç¬¦ä¸², ç”¨åå¼•å·(`)æ ‡è¯†, å¯ä»¥å½“åšæ™®é€šå­—ç¬¦ä¸², ä¹Ÿå¯ä»¥å®šä¹‰å¤šè¡Œå­—ç¬¦ä¸², æˆ–è€…åœ¨å­—ç¬¦ä¸²ä¸­åµŒå…¥å˜é‡.

```js
"hello" === `hello`; // true

const world = "world";
`hello world` === `hello ${world}`; // true

// å¤šè¡Œå­—ç¬¦ä¸²
`In JavaScript this is
 not legal.`;
```

## 6.å®ä¾‹: æ¨¡æ¿ç¼–è¯‘

ä¸‹é¢æ¥çœ‹ä¸€ä¸ªæ¨¡æ¿å­—ç¬¦ä¸²ç”Ÿæˆæ­£å¼æ¨¡æ¿çš„å®ä¾‹

```js
let template = `
<ul>
  <% for(let i=0; i < data.supplies.length; i++) { %>
    <li><%= data.supplies[i] %></li>
  <% } %>
</ul>
`;
```

å¯ä»¥å°†å…¶è½¬æ¢ä¸º JavaScript è¡¨è¾¾å¼å­—ç¬¦ä¸², æ¯”å¦‚:

```js
echo("<ul>");
for (let i = 0; i < data.supplies.length; i++) {
  echo("<li>");
  echo(data.supplies[i]);
  echo("</li>");
}
echo("</ul>");
```

å¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼:

```js
let evalExpr = /<%=(.+?)%>/g;
let expr = /<%([\s\S]+?)%>/g;

template = template
  .replace(evalExpr, "`); \n  echo( $1 ); \n  echo(`")
  .replace(expr, "`); \n $1 \n  echo(`");

template = "echo(`" + template + "`);";
```

å°†`template`å°è£…åœ¨ä¸€ä¸ªå‡½æ•°é‡Œé¢

```js
let script = `(function parse(data){
  let output = "";

  function echo(html){
    output += html;
  }

  ${template}

  return output;
})`;

return script;
```

ç„¶åå°†å…¶å°è£…æˆä¸€ä¸ªæ¨¡æ¿ç¼–è¯‘å‡½æ•° complie

```js
function compile(template) {
  const evalExpr = /<%=(.+?)%>/g;
  const expr = /<%([\s\S]+?)%>/g;

  template = template
    .replace(evalExpr, "`); \n  echo( $1 ); \n  echo(`")
    .replace(expr, "`); \n $1 \n  echo(`");

  template = "echo(`" + template + "`);";

  let script = `(function parse(data){
    let output = "";

    function echo(html){
      output += html;
    }

    ${template}

    return output;
  })`;

  return script;
}
```

complie å‡½æ•°çš„ç”¨æ³•å¦‚ä¸‹:

```js
let parse = eval(compile(template));
div.innerHTML = parse({ supplies: ["broom", "mop", "cleaner"] });
//   <ul>
//     <li>broom</li>
//     <li>mop</li>
//     <li>cleaner</li>
//   </ul>
```

## 7.æ ‡ç­¾æ¨¡æ¿

å‡½æ•°ååé¢ç´§è·Ÿç€æ¨¡æ¿å­—ç¬¦ä¸², è¢«ç§°ä¸ºæ ‡ç­¾æ¨¡æ¿çš„åŠŸèƒ½. å®é™…ä¸Šæ˜¯å‡½æ•°è°ƒç”¨çš„ä¸€ç§ç‰¹æ®Šå½¢å¼, æ ‡ç­¾æŒ‡å‡½æ•°, ç´§è·Ÿåœ¨åé¢çš„æ¨¡æ¿å­—ç¬¦ä¸²å°±æ˜¯å‚æ•°.

```js
alert`hello`;
// ç­‰åŒäº
alert(["hello"]);
```

å¦‚æœæ¨¡æ¿å­—ç¬¦ä¸²é‡Œé¢æœ‰å˜é‡, é‚£ä¼šå°†æ¨¡æ¿å­—ç¬¦ä¸²å…ˆå¤„ç†æˆå¤šä¸ªå‚æ•°, å†è°ƒç”¨å‡½æ•°.

```js
let a = 5;
let b = 10;

tag`Hello ${a + b} world ${a * b}`;
// ç­‰åŒäº
tag(["Hello ", " world ", ""], 15, 50);

function tag(stringArr, value1, value2) {
  // ...
}
ÃŸ;

// ç­‰åŒäº

function tag(stringArr, ...values) {
  // ...
}
```

ä¸‹é¢è¿™ä¸ªä¾‹å­å±•ç¤ºäº†å¦‚ä½•å°†å„ä¸ªå‚æ•°æŒ‰ç…§åŸæ¥çš„ä½ç½®æ‹¼æ¥ä¸Šå»:

```js
let total = 30;
let msg = passthru`The total is ${total} (${total * 1.05} with tax)`;

function passthru(literals, ...values) {
  let output = "";
  let index;
  for (index = 0; index < values.length; index++) {
    output += literals[index] + values[index];
  }

  output += literals[index];
  return output;
}

msg; // "The total is 30 (31.5 with tax)"
```

æ ‡ç­¾æ¨¡æ¿çš„ä¸€ä¸ªé‡è¦ç”¨ç”¨å°±æ˜¯è¿‡æ»¤ HTML å­—ç¬¦ä¸², é˜²æ­¢ç”¨æˆ·è¾“å…¥æ¶æ„å†…å®¹

```js
let message = SaferHTML`<p>${sender} has sent you a message.</p>`;

function SaferHTML(templateData) {
  let s = templateData[0];
  for (let i = 1; i < arguments.length; i++) {
    let arg = String(arguments[i]);

    // Escape special characters in the substitution.
    s += arg.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");

    // Don't escape special characters in the template.
    s += templateData[i];
  }
  return s;
}
```

`sender`å˜é‡å¾€å¾€æ˜¯ç”¨æˆ·æä¾›çš„, ç»è¿‡å¤„ç†å, é‡Œé¢çš„ç‰¹æ®Šå­—ç¬¦éƒ½ä¼šè¢«è½¬ä¹‰

```js
let sender = '<script>alert("abc")</script>'; // æ¶æ„ä»£ç 
let message = SaferHTML`<p>${sender} has sent you a message.</p>`;

message;
// <p>&lt;script&gt;alert("abc")&lt;/script&gt; has sent you a message.</p>
```

æ ‡ç­¾æ¨¡æ¿çš„å¦ä¸€ä¸ªåº”ç”¨å°±æ˜¯å¤šè¯­è¨€è½¬æ¢

```js
i18n`Welcome to ${siteName}, you are visitor number ${visitorNumber}!`;
// "æ¬¢è¿è®¿é—®xxxï¼Œæ‚¨æ˜¯ç¬¬xxxxä½è®¿é—®è€…ï¼"
```

è¿˜å¯ä»¥ä½¿ç”¨æ ‡ç­¾æ¨¡æ¿åµŒå…¥å…¶ä»–è¯­è¨€

```js
jsx`
  <div>
    <input
      ref='input'
      onChange='${this.handleChange}'
      defaultValue='${this.state.value}' />
      ${this.state.value}
   </div>
`;

java`
class HelloWorldApp {
  public static void main(String[] args) {
    System.out.println("Hello World!"); // Display the string.
  }
}
`;
HelloWorldApp.main();
```

æ ‡ç­¾æ¨¡æ¿å¤„ç†å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°, è¿˜æœ‰ä¸€ä¸ª`raw`å±æ€§, ä¿å­˜çš„æ˜¯è½¬ä¹‰åçš„æºå­—ç¬¦ä¸²

```js
tag`First line\nSecond line`;

function tag(strings) {
  console.log(strings.raw[0]);
  // strings.raw[0] ä¸º "First line\\nSecond line"
  // æ‰“å°è¾“å‡º "First line\nSecond line"
}
```

## 8.æ¨¡æ¿å­—ç¬¦ä¸²çš„é™åˆ¶

æ ‡ç­¾æ¨¡æ¿å¯ä»¥å†…åµŒå…¶ä»–è¯­è¨€, ä½†æ˜¯æ¨¡æ¿å­—ç¬¦ä¸²é»˜è®¤ä¼šå°†å­—ç¬¦ä¸²è½¬ä¹‰, å¯¼è‡´æ— æ³•åµŒå…¥å…¶ä»–è¯­è¨€

æ¯”å¦‚, æ ‡ç­¾æ¨¡æ¿é‡Œé¢å¯ä»¥åµŒå…¥ LaTEX è¯­è¨€

```js
function latex(strings) {
  // ...
}

let document = latex`
\newcommand{\fun}{\textbf{Fun!}}  // æ­£å¸¸å·¥ä½œ
\newcommand{\unicode}{\textbf{Unicode!}} // æŠ¥é”™
\newcommand{\xerxes}{\textbf{King!}} // æŠ¥é”™

Breve over the h goes \u{h}ere // æŠ¥é”™
`;
```

ä¸Šé¢è¿™æ®µä»£ç åœ¨ LaTEX è¯­è¨€ä¸­æ˜¯åˆæ³•çš„, ä½†æ˜¯åœ¨ Javascript å¼•æ“ä¸­ä¼šæŠ¥é”™, å› ä¸ºå­—ç¬¦ä¸²çš„è½¬ä¹‰.

`\u`å’Œ`\x`åœ¨ LaTEX ä¸­æœ‰ç‰¹æ®Šå«ä¹‰, ä½†æ˜¯åœ¨ JavaScript ä¸­ä¼šå°†ä»–ä»¬å½“åš Unicode ç¼–ç å’Œåå…­è¿›åˆ¶è¿›è¡Œè½¬ä¹‰.

ES2018 æ”¾æ¾äº†å¯¹**æ ‡ç­¾æ¨¡æ¿**ä¸­çš„å­—ç¬¦ä¸²è½¬ä¹‰é™åˆ¶, é‡åˆ°ä¸åˆæ³•çš„å­—ç¬¦ä¸²è½¬ä¹‰ä¼šè¿”å› undefined, è€Œä¸æ˜¯æŠ¥é”™. ä½†æ˜¯å¯¹äºæ™®é€šæ¨¡æ¿å­—ç¬¦ä¸²è¿˜æ˜¯ä¼šæŠ¥é”™.

```js
function tag(strs) {
  strs[0] === undefined;
  strs.raw[0] === "\\unicode and \\u{55}";
}
tag`\unicode and \u{55}`;

let bad = `bad escape sequence: \unicode`; // æŠ¥é”™
```

# å­—ç¬¦ä¸²çš„æ–°å¢æ–¹æ³•

## 1.String.fromCodePoint()

ES5 çš„`String.fromCharCode()`æ–¹æ³•è¡¥èƒ½è¯†åˆ«å¤§äº`0xFFFF`çš„å­—ç¬¦, ES6 æ–°å¢äº†`String.fromCodePoint()`æ–¹æ³•, å¯ä»¥è¯†åˆ«å¤§äº`0xFFFF`çš„å­—ç¬¦.

```js
String.fromCharCode(0x20bb7); // "à®·"
String.fromCodePoint(0x20bb7); // "ğ ®·"
String.fromCharCode(0x78, 0x1f680, 0x79); // "xïš€y"
String.fromCodePoint(0x78, 0x1f680, 0x79); // "xğŸš€y"
```

æ³¨æ„: `fromCodePoint`æ–¹æ³•å®šä¹‰åœ¨`String`å¯¹è±¡ä¸Š, è€Œ`codePointAt`æ–¹æ³•å®šä¹‰åœ¨å­—ç¬¦ä¸²çš„å®ä¾‹å¯¹è±¡ä¸Š.

## 2.String.raw()

ES6 ä¸ºåŸç”Ÿçš„ String å¯¹è±¡æä¾›äº†`raw()`æ–¹æ³•, è¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªæ–œæ éƒ½è¢«è½¬ä¹‰çš„å­—ç¬¦ä¸², ç”¨äºæ¨¡æ¿å­—ç¬¦ä¸²çš„å¤„ç†æ–¹æ³•.

```js
String.raw`Hi\n${2 + 3}!`;
// å®é™…è¿”å› "Hi\\n5!"ï¼Œæ˜¾ç¤ºçš„æ˜¯è½¬ä¹‰åçš„ç»“æœ "Hi\n5!"

String.raw`Hi\u000A!`;
// å®é™…è¿”å› "Hi\\u000A!"ï¼Œæ˜¾ç¤ºçš„æ˜¯è½¬ä¹‰åçš„ç»“æœ "Hi\u000A!"

String.raw`Hi\\n`;
// è¿”å› "Hi\\\\n"

String.raw`Hi\\n` === "Hi\\\\n"; // true
```

`String.raw()`æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªæ­£å¸¸çš„å‡½æ•°, ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å…·æœ‰`raw`å±æ€§çš„å¯¹è±¡, æ¥å—ä¸€ä¸ªæ•°ç»„, å¯¹åº”æ¨¡æ¿å­—ç¬¦ä¸²è§£æåçš„å€¼

```js
`foo${1 + 2}bar` === String.raw({ raw: ["foo", "bar"] }, 1 + 2);
String.raw`Hi\n${2 + 3}!` === String.raw({ raw: ["Hi\\n", "!"] }, 2 + 3);
```

`String.raw()`çš„ä»£ç å®ç°åŸºæœ¬å¦‚ä¸‹:

```js
String.raw = function (strings, ...values) {
  let output = "";
  let index;
  for (index = 0; index < values.length; index++) {
    output += strings.raw[index] + values[index];
  }

  output += strings.raw[index];
  return output;
};
```

## 3.å®ä¾‹æ–¹æ³•:codePointAt()

ä¸`String.fromCodePointç±»ä¼¼`, éœ€è¦æ³¨æ„çš„æ˜¯ `fromCodePoint`æ–¹æ³•å®šä¹‰åœ¨`String`å¯¹è±¡ä¸Š, è€Œ`codePointAt`æ–¹æ³•å®šä¹‰åœ¨å­—ç¬¦ä¸²çš„å®ä¾‹å¯¹è±¡ä¸Š.

```js
String.fromCodePoint(0x20bb7); // "ğ ®·"

"ğ ®·".length; // 2
"ğ ®·".codePointAt(0); // 134071
"ğ ®·".codePointAt(1); // 57271
"ğ ®·".charCodeAt(0); // 55362
"ğ ®·".charCodeAt(1); // 57271
```

ä»`"ğ ®·".codePointAt(1); // 57271`è¿™ä¸ªæ–¹æ³•çœ‹å‡º, ä¸€ä¸ª 4 å­—èŠ‚çš„å­—ç¬¦, ä¸‹æ ‡ä¸º 1 çš„ä½ç½®ä¸Šæ˜¯è¿™ä¸ªå­—ç¬¦çš„åä¸¤ä¸ªå­—èŠ‚.

å¯ä»¥ä½¿ç”¨`for...of`å¾ªç¯æ¥æ­£ç¡®è¯†åˆ« 32 ä½çš„ UTF-16 å­—ç¬¦, æˆ–è€…ä½¿ç”¨æ‰©å±•è¿ç®—ç¬¦è¿›è¡Œå±•å¼€è¿ç®—. å¦å¤–`codePointAt()`è¿™ä¸ªæ–¹æ³•è¿”å›çš„æ˜¯åè¿›åˆ¶çš„ç ç‚¹, å¯ä»¥ä½¿ç”¨`toString(16)`å°†åè¿›åˆ¶ç ç‚¹è½¬æ¢ä¸ºåå…­è¿›åˆ¶çš„ç ç‚¹.

```js
let s = "ğ ®·a";
for (let ch of s) {
  console.log(ch.codePointAt(0).toString(16));
}
// 20bb7
// 61

let arr = [..."ğ ®·a"]; // arr.length === 2
arr.forEach((ch) => console.log(ch.codePointAt(0).toString(16)));
// 20bb7
// 61
```

`codePointAt()`æ–¹æ³•æ˜¯æµ‹è¯•ä¸€ä¸ªå­—ç¬¦ç”±ä¸¤å­—èŠ‚è¿˜æ˜¯å››å­—èŠ‚ç»„æˆçš„æœ€ç®€å•æ–¹æ³•

```js
function is32Bit(c) {
  return c.codePointAt(0) > 0xffff;
}

is32Bit("ğ ®·"); // true
is32Bit("a"); // false
```

## 4.å®ä¾‹æ–¹æ³•:normalize()

è®¸å¤šæ¬§æ´²è¯­è¨€æœ‰è¯­è°ƒç¬¦å·å’Œé‡éŸ³ç¬¦å·, Unicode æœ‰ä¸¤ç§æ–¹æ³•è¡¨ç¤ºå®ƒä»¬. ä¸€ç§æ˜¯å¸¦é‡éŸ³ç¬¦å·çš„å­—ç¬¦, æ¯”å¦‚`Ç‘`(`\u01D1`); è¿˜æœ‰ä¸€ç§æ˜¯æä¾›åˆæˆç¬¦å·, ä¸¤ä¸ªå­—ç¬¦åˆæˆä¸€ä¸ªå­—ç¬¦, æ¯”å¦‚`O`(`\u004F`)å’Œ`Ë‡`(`\u030C`)åˆæˆ`Ç‘`(`\u004F\u030C`)

è¿™ä¸¤ç§æ–¹æ³•åœ¨è§†è§‰å’Œè¯­ä¹‰ä¸Šç­‰ä»·, ä½†æ˜¯ JavaScript ä¸èƒ½è¯†åˆ«.

```js
"\u01D1"; // 'Ç‘'
"\u004F\u030C"; // 'OÌŒ'

"\u01D1" === "\u004F\u030C"; //false

"\u01D1".length; // 1
"\u004F\u030C".length; // 2

"\u01D1".normalize() === "\u004F\u030C".normalize(); // true
```

ES6 æä¾›å­—ç¬¦ä¸²å®ä¾‹çš„`normalize()`æ–¹æ³•, ç”¨æ¥å°†å­—ç¬¦çš„ä¸åŒè¡¨ç¤ºæ–¹æ³•ç»Ÿä¸€ä¸ºåŒæ ·çš„å½¢å¼, æˆä¸º Unicode æ­£è§„åŒ–. ä»–å¯ä»¥æ¥å—å‚æ•°æ¥æŒ‡å®š`normalize`çš„æ–¹å¼, å››ä¸ªå¯é€‰å€¼å¦‚ä¸‹:

- `NFC`, é»˜è®¤å‚æ•°, è¡¨ç¤º"æ ‡å‡†ç­‰ä»·åˆæˆ"(Normalization Form Canonical Composition), è¿”å›å¤šä¸ªç®€å•å­—ç¬¦çš„åˆæˆå­—ç¬¦. æŒ‡çš„æ˜¯è§†è§‰å’Œè¯­ä¹‰ä¸Šçš„ç­‰ä»·.
- `NFD`, è¡¨ç¤º"æ ‡å‡†ç­‰ä»·åˆ†è§£"(Normalization Form Canonical Decomposition), å³åœ¨æ ‡å‡†çš„å‰æä¸‹, è¿”å›åˆæˆå­—ç¬¦åˆ†è§£çš„å¤šä¸ªç®€å•å­—ç¬¦.
- `NFKC`, è¡¨ç¤º"å…¼å®¹ç­‰ä»·åˆæˆ"(Normalization Form Compatibility Composition), è¿”å›åˆæˆå­—ç¬¦, æŒ‡çš„æ˜¯åœ¨è¯­ä¹‰ä¸Šç­‰ä»·, ä½†è§†è§‰ä¸Šä¸ç­‰ä»·, æ¯”å¦‚"å›"å’Œ"å–œå–œ"(ç”¨äºä¸¾ä¾‹, normalize æ–¹æ³•ä¸èƒ½è¯†åˆ«ä¸­æ–‡)
- `NFKD`, è¡¨ç¤º"å…¼å®¹ç­‰ä»·åˆ†è§£"(Normalization Form Compatibility Decomposition), å³åœ¨å…¼å®¹ç­‰ä»·çš„å‰æä¸‹, è¿”å›åˆæˆå­—ç¬¦åˆ†è§£çš„å¤šä¸ªç®€å•å­—ç¬¦.

```js
"\u004F\u030C".normalize("NFC").length; // 1 è¿”å›åˆæˆå­—ç¬¦
"\u004F\u030C".normalize("NFD").length; // 2 è¿”å›åˆ†è§£å­—ç¬¦
```

æ³¨æ„: `normalize()`æ–¹æ³•ç›®å‰ä¸èƒ½è¯†åˆ«ä¸‰ä¸ªå­—ç¬¦ä»¥ä¸Šçš„åˆæˆ, è¿™ç§æƒ…å†µåªèƒ½ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼, é€šè¿‡ Unicode ç¼–ç åŒºé—´åˆ¤æ–­.

## 5.å®ä¾‹æ–¹æ³•:includes(),startsWith(),endsWith()

åˆ¤æ–­ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯å¦åœ¨å¦ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­, åŸæœ¬æœ‰`indexOf()`æ–¹æ³•, ES6 æ–°å¢äº†ä¸‰ç§æ–¹æ³•:

- `includes()` è¿”å›å¸ƒå°”å€¼, è¡¨ç¤ºæ˜¯å¦æ‰¾åˆ°äº†å‚æ•°ä¸­çš„å­—ç¬¦ä¸²
- `startsWith()` è¿”å›å¸ƒå°”å€¼, è¡¨ç¤ºå‚æ•°å­—ç¬¦ä¸²æ˜¯å¦åœ¨åŸå­—ç¬¦ä¸²å¤´éƒ¨
- `endsWith()` è¿”å›å¸ƒå°”å€¼, è¡¨ç¤ºå‚æ•°å­—ç¬¦ä¸²æ˜¯å¦åœ¨åŸå­—ç¬¦ä¸²å°¾éƒ¨

```js
let s = "Hello world!";

s.startsWith("Hello"); // true
s.endsWith("!"); // true
s.includes("o"); // true
```

è¿™å‡ ä¸ªæ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºå¼€å§‹æœç´¢çš„ä½ç½®:

```js
let s = "Hello world!";

s.indexOf("e", 2); // -1
s.startsWith("world", 6); // true
s.endsWith("e", 2); // true
s.includes("H", 1); // false
```

æ³¨æ„: `endsWith`æ˜¯ä»`0-n`, è€Œå…¶ä»–å‡ ä¸ªæ–¹æ³•æ˜¯ä»`n-length`.

## 6.å®ä¾‹æ–¹æ³•:repeat()

`repeat`æ–¹æ³•è¿”å›ä¸€ä¸ªæ–°å­—ç¬¦ä¸², è¡¨ç¤ºå°†åŸå­—ç¬¦é‡å¤`n`æ¬¡. å¦‚æœå‚æ•°ä¸ºå°æ•°ä¼šå–æ•´, å¦‚æœå‚æ•°ä¸º 0 åˆ°-1 ä¹‹é—´çš„å°æ•°åˆ™æ˜¯ä¸º 0(è¿™æ˜¯å› ä¸ºä¼šå…ˆè¿›è¡Œå–æ•´æ“ä½œ), å¦‚æœå‚æ•°ä¸ºè´Ÿæ•°æˆ–è€…`Infinity`ä¼šæŠ¥é”™, å¦‚æœå‚æ•°ä¸ºå­—ç¬¦ä¸²åˆ™ä¼šå…ˆè½¬æ¢æˆæ•°å­—.

```js
"x".repeat(3); // "xxx"
"hello".repeat(2); // "hellohello"
"na".repeat(0); // ""

"na".repeat(2.9); // "nana" å¦‚æœæ˜¯å°æ•°ä¼šè¢«å–æ•´
"na".repeat(-0.9); // "" å…ˆå–æ•´ä¸º0

"na".repeat(Infinity); // RangeError
"na".repeat(-1); // RangeError

"na".repeat("na"); // ""
"na".repeat("3"); // "nanana"
```

## 7.å®ä¾‹æ–¹æ³•:padStart(), padEnd()

ES2017 å¼•å…¥äº†å­—ç¬¦ä¸²è¡¥å…¨é•¿åº¦çš„åŠŸèƒ½, `padStart()`ç”¨äºå¤´éƒ¨è¡¥å…¨, `padEnd()`ç”¨äºå°¾éƒ¨è¡¥å…¨. å¦‚æœåŸå­—ç¬¦ä¸²é•¿åº¦ç­‰äºæˆ–è€…å¤§äºæœ€å¤§é•¿åº¦, åˆ™è¿”å›åŸå­—ç¬¦ä¸²; å¦‚æœçœç•¥ç¬¬äºŒä¸ªå‚æ•°, é»˜è®¤ä½¿ç”¨ç©ºæ ¼è¡¥å…¨é•¿åº¦.

```js
"x".padStart(5, "ab"); // 'ababx'
"x".padStart(4, "ab"); // 'abax'

"x".padEnd(5, "ab"); // 'xabab'
"x".padEnd(4, "ab"); // 'xaba'

"xxx".padStart(2, "ab"); // 'xxx'
"xxx".padEnd(2, "ab"); // 'xxx'

"x".padStart(4); // '   x'
"x".padEnd(4); // 'x   '
```

`padStart()`å¸¸è§ç”¨é€”æ˜¯ä¸ºæ•°å€¼è¡¥å…¨æŒ‡å®šä½æ•°

```js
// ç”Ÿæˆ10ä½çš„æ•°å€¼å­—ç¬¦ä¸²
"1".padStart(10, "0"); // "0000000001"
"12".padStart(10, "0"); // "0000000012"
"123456".padStart(10, "0"); // "0000123456"
```

å¦ä¸€ä¸ªç”¨é€”æ˜¯æç¤ºå­—ç¬¦ä¸²æ ¼å¼

```js
"12".padStart(10, "YYYY-MM-DD"); // "YYYY-MM-12"
"09-12".padStart(10, "YYYY-MM-DD"); // "YYYY-09-12"
```

## 8.å®ä¾‹æ–¹æ³•: trimStart(), trimEnd()

ES2019 å¯¹å­—ç¬¦ä¸²ç¤ºä¾‹å¢åŠ äº†`trimStart()`å’Œ`trimEnd()`æ–¹æ³•, è¡Œä¸ºä¸`trim()`ä¸€è‡´, `trimStart()`æ¶ˆé™¤å­—ç¬¦ä¸²å¤´éƒ¨ç©ºæ ¼, `trimEnd()`æ¶ˆé™¤å°¾éƒ¨ç©ºæ ¼, éƒ½è¿”å›æ–°å­—ç¬¦ä¸², ä¸ä¼šä¿®æ”¹åŸå­—ç¬¦ä¸². é™¤äº†ç©ºæ ¼, å¯¹ tab é”®, æ¢è¡Œç¬¦ç­‰ä¸å¯è§çš„ç©ºç™½ç¬¦å·ä¹Ÿæœ‰æ•ˆ.

```js
const s = "  abc  ";

s.trim(); // "abc"
s.trimStart(); // "abc  "
s.trimEnd(); // "  abc"
```

æµè§ˆå™¨è¿˜éƒ¨ç½²äº†é¢å¤–ä¸¤ä¸ªæ–¹æ³•: `trimLeft()`æ˜¯`trimStart()`çš„åˆ«å, `trimRight()`æ˜¯`trimEnd()`çš„åˆ«å.

## 9.å®ä¾‹æ–¹æ³•: matchAll()

`matchAll()`è¿”å›ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼åœ¨å½“å‰å­—ç¬¦ä¸²çš„æ‰€æœ‰åŒ¹é….

## 10.å®ä¾‹æ–¹æ³•: replaceAll()

ES2021 å¼•å…¥äº†`replaceAll()`, ä¸`replace(/xx/g)`ç±»ä¼¼. ä¸ä¼šæ”¹å˜åŸå­—ç¬¦ä¸².

```js
String.prototype.replaceAll(searchValue, replacement);
```

`searchValue`æ˜¯æœç´¢æ¨¡å¼, å¯ä»¥ä½¿ä¸€ä¸ªå­—ç¬¦ä¸², ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªå…¨å±€çš„æ­£åˆ™è¡¨è¾¾å¼(å³å¸¦æœ‰`g`ä¿®é¥°ç¬¦, **å¦‚æœä¸å¸¦`g`ä¿®é¥°ç¬¦ä¼šæŠ¥é”™**).

`replacement`æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æˆ–è€…å‡½æ•°, è¿”å›æ›¿æ¢çš„æ–‡æœ¬.

1. å½“`replacement`ä¸ºå­—ç¬¦ä¸²æ—¶, å¯ä»¥ä½¿ç”¨ä¸€äº›ç‰¹æ®Šå­—ç¬¦ä¸²:

- `$&`: åŒ¹é…çš„å­—ç¬¦ä¸²
- `` $` ``: åŒ¹é…ç»“æœå‰é¢çš„æ–‡æœ¬
- `$'`: åŒ¹é…ç»“æœåé¢çš„æ–‡æœ¬
- `$n`: åŒ¹é…æˆåŠŸçš„ç¬¬ n ç»„å†…å®¹, n æ˜¯ä» 1 å¼€å§‹çš„è‡ªç„¶æ•°. è¿™ä¸ªå‚æ•°ç”Ÿæ•ˆçš„å‰ææ˜¯, ç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯æ­£åˆ™è¡¨è¾¾å¼
- `$$`: æŒ‡ä»£ç¾å…ƒç¬¦å·`$`

```js
// $& è¡¨ç¤ºåŒ¹é…çš„å­—ç¬¦ä¸²ï¼Œå³`b`æœ¬èº«
// æ‰€ä»¥è¿”å›ç»“æœä¸åŸå­—ç¬¦ä¸²ä¸€è‡´
"abbc".replaceAll("b", "$&");
// 'abbc'

// $` è¡¨ç¤ºåŒ¹é…ç»“æœä¹‹å‰çš„å­—ç¬¦ä¸²
// å¯¹äºç¬¬ä¸€ä¸ª`b`ï¼Œ$` æŒ‡ä»£`a`
// å¯¹äºç¬¬äºŒä¸ª`b`ï¼Œ$` æŒ‡ä»£`ab`
"abbc".replaceAll("b", "$`");
// 'aaabc'

// $' è¡¨ç¤ºåŒ¹é…ç»“æœä¹‹åçš„å­—ç¬¦ä¸²
// å¯¹äºç¬¬ä¸€ä¸ª`b`ï¼Œ$' æŒ‡ä»£`bc`
// å¯¹äºç¬¬äºŒä¸ª`b`ï¼Œ$' æŒ‡ä»£`c`
"abbc".replaceAll("b", `$'`);
// 'abccc'

// $1 è¡¨ç¤ºæ­£åˆ™è¡¨è¾¾å¼çš„ç¬¬ä¸€ä¸ªç»„åŒ¹é…ï¼ŒæŒ‡ä»£`ab`
// $2 è¡¨ç¤ºæ­£åˆ™è¡¨è¾¾å¼çš„ç¬¬äºŒä¸ªç»„åŒ¹é…ï¼ŒæŒ‡ä»£`bc`
"abbc".replaceAll(/(ab)(bc)/g, "$2$1");
// 'bcab'

// $$ æŒ‡ä»£ $
"abc".replaceAll("b", "$$");
// 'a$c'
```

2. å½“`replacement`ä¸ºå‡½æ•°, è¿”å›å€¼å°†ä»£æ›¿ç¬¬ä¸€ä¸ªå‚æ•°åŒ¹é…çš„æ–‡æœ¬

```js
"aabbcc".replaceAll("b", () => "_"); // 'aa__cc'
```

è¿™ä¸ªå‡½æ•°æ¥å—å¤šä¸ªå‚æ•°, ç¬¬ä¸€ä¸ªæ˜¯å‚æ•°åŒ¹é…åˆ°çš„å†…å®¹, ç¬¬äºŒä¸ªå‚æ•°æ˜¯ç»„åŒ¹é…(æœ‰å¤šå°‘ä¸ªç»„åŒ¹é…`()`å°±æœ‰å¤šå°‘ä¸ªå‚æ•°), å€’æ•°ç¬¬äºŒä¸ªå‚æ•°æ˜¯æ•æ‰åˆ°çš„å†…å®¹åœ¨æ•´ä¸ªå­—ç¬¦ä¸²ä¸­çš„ä½ç½®, æœ€åä¸€ä¸ªå‚æ•°æ˜¯åŸå­—ç¬¦ä¸².

```js
const str = "123abc456";
const regex = /(\d+)([a-z]+)(\d+)/g;

function replacer(match, p1, p2, p3, offset, string) {
  console.log(match, p1, p2, p3, offset, string);
  // 123abc456 123 abc 456 0 123abc456,7d8
  // 7d8 7 d 8 10 123abc456,7d8
  return [p1, p2, p3].join(" - ");
}

str.replaceAll(regex, replacer);
// 123 - abc - 456
```

## 11.å®ä¾‹æ–¹æ³•: at()

`at()`æ¥å—ä¸€ä¸ªæ•´æ•°ä½œä¸ºå‚æ•°, è¿”å›æŒ‡å®šä½ç½®çš„å­—ç¬¦, æ”¯æŒè´Ÿç´¢å¼•. å¦‚æœå‚æ•°ä½ç½®è¶…è¿‡äº†å­—ç¬¦ä¸²èŒƒå›´, è¿”å›`undefined`.

```js
const str = "hello";
str.at(1); // "e"
str.at(-1); // "o"
```
